
variables:
  GIT_STRATEGY: fetch


BM_combination_tests:
  stage: test
  before_script:
    - echo AMS tests
  script:
    - pytest "Tests/BM combinations" -n 2
  except:
    -  /^docs.*$/
  tags:
    - ams

other_tests:
  stage: test
  before_script:
    - echo AMS tests
  script:
    - pytest "--ignore=Tests/BM combinations" "--ignore=Tests/Application Tests"
  except:
    -  /^docs.*$/
  tags:
    - ams

Application_tests:
  before_script:
    - echo AMS tests
  stage: test
  script:
    - pytest --ff Tests/Applications -n 4
  except:
    -  /^docs.*$/
  tags:
    - ams

    


before_script:
  - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
  - bash miniconda.sh -b -p $HOME/miniconda
  - export PATH="$HOME/miniconda/bin:$PATH"
  - hash -r
  - conda config --set always_yes yes --set changeps1 no
  - conda config --add channels conda-forge # For sphinxcontrib.autoprogram
  - conda update -q conda 
  - conda info -a
  - conda create -q -n doc-build-environment python=3.6 sphinx cloud_sptheme pygments_anyscript
  - source activate doc-build-environment
  - pip install sphinxcontrib-fulltoc

test_docs:
  script:
    - set -e
    - cd Docs
    - make html

  only:
    - branches

  tags:
    - docker
    - linux

  allow_failure: false


stage_docs:
  stage: deploy

  script:
    - set -e
    - cd Docs
    - make html
  
  only: 
    - master
    - triggers

  tags:
    - docker
    - linux

  allow_failure: false


deploy_docs:
  stage: deploy

  script:
    - set -e
    - cd Docs
    - make html
  
  only: 
    - tags

  except:
    - branches

  tags:
    - docker
    - linux

  allow_failure: false