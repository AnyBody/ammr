AnyFolder Joints = 
{
  
};

AnyFolder Drivers = 
{
  AnyFolder &JntPos= Main.HumanModel.Mannequin.Posture;  
  AnyFolder &JntVel= Main.HumanModel.Mannequin.PostureVel;
  
  AnyFolder CoM_Control_Def = 
  {
    AnyKinCoM CoM_Measure = 
    {
      AnyFolder &Body = Main.Model.HumanModel; 
    };    
    
//    AnyKinEqFourierDriver CoM_X_Driver = 
//    {
//      AnyVar HeelContactNodeLow_X = ....Environment.GlobalRef.FootPrintBase_Right.FP1.HeelContactNodeLow.sRel[0];
//      AnyVar ToeLateralContactNode_X = ....Environment.GlobalRef.FootPrintBase_Right.FP1.ToeLateralContactNode.sRel[0];
//      AnyVar ToeMedialContactNode_X = ....Environment.GlobalRef.FootPrintBase_Right.FP1.ToeMedialContactNode.sRel[0];
//      AnyVar MinSideContactNode_X = min({ToeLateralContactNode_X, ToeMedialContactNode_X}) ;
//      
//      AnyVar range_min = HeelContactNodeLow_X + (MinSideContactNode_X - HeelContactNodeLow_X) * 0.1;
//      AnyVar range_max = MinSideContactNode_X - (MinSideContactNode_X - HeelContactNodeLow_X) * 0.1 ;
//      
//      AnyKinMeasureLinComb lincomb = 
//      {
//        AnyKinMeasureOrg org = 
//        {
//          AnyKinLinear lin = 
//          {
//            AnyRefFrame& ref0 = Main.Model.Environment.GlobalRef.FootPrintBase_Right.FP1;
//            AnyRefFrame& ref1 = ....CoM_DummySeg ;
//            Ref = 0;
//          };
//          MeasureOrganizer = {0}; 
//        };
//        Coef = {{1.0}};
//        Const = {-0.5*(.range_max + .range_min)};
//        OutDim = 1;
//      };
//      Type = Cos;
//      Freq = 1/ADL_SQUAT_TIME_PERIOD;
//      A = {{0.0, -0.5*(range_min - range_max)}};
//      B = {{0.0, 0.0}};
//      Reaction.Type = {Off};
//    };  
    
    AnyKinEqSimpleDriver CoM_Z_Driver = 
    {
      AnyKinMeasure& ref = .CoM_Measure;
      MeasureOrganizer = {2}; 
      DriverPos = {0};
      DriverVel = {0};
      Reaction.Type = {Off};
    };    
     
    AnySeg CoM_DummySeg =
    {
      Mass=0;
      Jii={0,0,0};
      r0 = Main.HumanModel.BodyModel.Trunk.SegmentsLumbar.PelvisSeg.r0;
      AnyDrawNode drw=
      { 
        ScaleXYZ={1,1,1}*0.05; 
        RGB={0,1,1};
        Opacity = 0.5;
      };
    };
    
    AnyKinLinear CoM_DummySeg_Lin =
    {
      AnySeg &ref =.CoM_DummySeg ;
    };
    
    AnyKinEq CoM_DummySeg_Driver =
    {
      AnyKinMeasureLinComb lincomb=
      {
        AnyKinMeasure &ref1 = ..CoM_DummySeg_Lin ;
        AnyKinMeasure &ref2 = ..CoM_Measure ;
        Coef={{1,0,0,-1,0,0},{0,1,0,0,-1,0},{0,0,1,0,0,-1}};
        OutDim = 3;
      };
      AnyKinRotational rot =
      {
        AnySeg &ref = ..CoM_DummySeg;
        Type=RotAxesAngles;
      };
    };
  };
  
  #include "TrunkDrivers.any"
  
  #if BM_ARM_RIGHT == ON
  #include "RightArmDrivers.any"
  #endif
  
  #if BM_ARM_LEFT == ON
  #include "LeftArmDrivers.any"
  #endif
  
  #if BM_LEG_RIGHT == ON
  #include "RightLegTLEMDrivers.any"
  #endif
  
  #if BM_LEG_LEFT == ON
  #include "LeftLegTLEMDrivers.any"
  #endif
};


