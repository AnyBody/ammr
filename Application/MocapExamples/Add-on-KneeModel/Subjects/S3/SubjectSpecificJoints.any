AnyFolder JointData = {
  #include "<SubjectDataPath>Shape Fitting Data\FemoralComponentPatellaJoint.any"
  #include "<SubjectDataPath>Shape Fitting Data\AnkleSphereFits.any"
  #include "<SubjectDataPath>Shape Fitting Data\LateralExtensionFacetCenter.any"
  #include "<SubjectDataPath>Shape Fitting Data\LateralFlexionFacetCenter.any"
  #include "<SubjectDataPath>Shape Fitting Data\MedialExtensionFacetCenter.any"
  #include "<SubjectDataPath>Shape Fitting Data\MedialFlexionFacetCenter.any"
  #include "<SubjectDataPath>Shape Fitting Data\PF_Extension.any"
  #include "<SubjectDataPath>Shape Fitting Data\PF_Flexion.any"
  
  //FIX THIS!  Need to include Flexion & Extension Facet Centers
  AnyVec3 KneeJointCylFitNode1 = {-50.5146, 6.6082, 61.4131}*1e-3;
  AnyVec3 KneeJointCylFitNode2 = {18.5169, 12.2298, 61.3927}*1e-3;
  
  AnyVec3 KneeOrigin = (KneeJointCylFitNode1 + KneeJointCylFitNode2)/2;
  AnyMat33 KneeOrientation= RotMat(-pi/2,z)*RotMat(pi/2,x);
  
  //AnyVec3 PatellaFemurOrigin = FemoralComponentPatellaJoint_Origin*1e-3; 
  AnyMat33 PatellaFemurOrientation = KneeOrientation;
  AnyVec3 PatellaFemurOrigin = KneeOrigin + {0.0, -0.01, 0.008}; // FIX THIS!!!
  //AnyMat33 PatellaFemurOrientation = KneeOrientation; // FIX THIS !!!
};

Femur = {
  
  KneeJoint = {
    AnyVec3 sRel_us = ..JointData.KneeOrigin;
    DEF_REFNODE_CUSTOM_SCALING_1arg(..JointData.KneeOrigin)
    DEF_REFNODE_CUSTOM_SCALING_ARel(..JointData.KneeOrientation)
    //AnyDrawRefFrame drw = {ScaleXYZ = {1,1,1}*5e-2; RGB = {0,0,1};};
  };
  
  PatellaFemurJoint = {
    DEF_REFNODE_CUSTOM_SCALING_1arg(..JointData.PatellaFemurOrigin)
    DEF_REFNODE_CUSTOM_SCALING_ARel(..JointData.PatellaFemurOrientation)
    //AnyDrawRefFrame drw = {ScaleXYZ = {1,1,1}*5e-2; RGB = {0,0,1};};
  };
  
  // FIX THIS!!!
  AnyRefNode HipCenter = {
    sRel = {-9.8474638564617,-36.9366073813764,460.2486847751230}*1e-3;
    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
//  
//  AnyRefNode  Lateral_EFC = {
//    sRel = ..JointData.LateralExtensionFacetCenterArea_Origin*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
//  };
//  AnyRefNode  Lateral_FFC = {
//    sRel = ..JointData.LateralFlexionFacetCenterArea_Origin*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
//  };
//  AnyRefNode  Medial_EFC = {
//    sRel = ..JointData.MedialExtensionFacetCenterArea_Origin*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
//  };
//  AnyRefNode  Medial_FFC = {
//    sRel = ..JointData.MedialFlexionFacetCenterArea_Origin*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
//  };

  
};

Tibia = {
  
  KneeJoint = {
    sRel = ..Femur.KneeJoint.sRel;
    ARel = ..Femur.KneeJoint.ARel;
    //AnyDrawRefFrame drw = {ScaleXYZ = {1,1,1}*5e-2; RGB = {1,0,0};};
  };
  
  // FIX THIS!!!
  AnyRefNode Subtalar1 = {
    sRel = ..JointData.Origin1*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  // FIX THIS!!!
  AnyRefNode Subtalar2 = {
    sRel = ..JointData.Origin2*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  // FIX THIS!!!
  AnyRefNode  SubtalarJointCenter = {
    sRel = (.Subtalar1.sRel+.Subtalar2.sRel)*0.5;
    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  // FIX THIS!!!
  AnyRefNode Talocrural1 = {
    sRel = ..JointData.Origin3*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  // FIX THIS!!!
  AnyRefNode  Talocrural2 = {
    sRel = ..JointData.Origin4*1e-3;
//    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  // FIX THIS!!!
  AnyRefNode  TalocruralJointCenter = {
    sRel = (.Talocrural1.sRel+.Talocrural2.sRel)*0.5;
    AnyDrawNode drw = {ScaleXYZ = {1,1,1}*3e-3; RGB = {0,0,1};};
  };
  
  AnyRefNode PatellaTendon = {
    sRel = {-0.0295514, -0.011955, -0.0111196}; // PT_attach1
  };
  
};

Patella = {
  
  PatellaFemurJoint = {
    sRel = ..Femur.PatellaFemurJoint.sRel;
    ARel = ..Femur.PatellaFemurJoint.ARel;
    //AnyDrawRefFrame drw = {ScaleXYZ = {1,1,1}*5e-2; RGB = {0,1,0};};
  };
  
  AnyRefNode PatellaTendon = {
    sRel = {-0.0215385, -0.0394242, 0.0491125};
  };
  
};
