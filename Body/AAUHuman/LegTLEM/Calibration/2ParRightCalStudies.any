LegCalibrationStudy LegCalibration1Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "AdductorMagnus*.*",
      "AdductorLong*.*",
      "AdductorBrevis*.*",
      "Pectineus.*",
      "Gracilis.*",
      "TensorFasciaeLatae.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(HipPositions);
  AnyObjectPtrArray HipPositions = repmat(2,{
    &.RangeOfMotion.Right.Leg.Hip.InternallyRotated,
    &.RangeOfMotion.Right.Leg.Hip.Adduction,
    &.RangeOfMotion.Right.Leg.Hip.Abduction,
    &.RangeOfMotion.Right.Leg.Hip.AbductedAndExternallyRotated,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAbducted,
    &.RangeOfMotion.Right.Leg.Hip.ExtendedAndAdducted,
  });
  
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle), 
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
  AnyObjectPtrArray SubTalarPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
};

LegCalibrationStudy LegCalibration2Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "Gluteus*.*",
      "Piriformis.*",
      "Gemellus.*",
      "Obturator*.*",
      "QuadratusFem*.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(HipPositions);
  AnyObjectPtrArray HipPositions = repmat(2,{
    &.RangeOfMotion.Right.Leg.Hip.InternallyRotated,
    &.RangeOfMotion.Right.Leg.Hip.Adduction,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.Flexed,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAbducted,
    &.RangeOfMotion.Right.Leg.Hip.AbductedAndExternallyRotated,
    &.RangeOfMotion.Right.Leg.Hip.Extended,
    &.RangeOfMotion.Right.Leg.Hip.ExtendedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.ExternallyRotated,
  });
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
  AnyObjectPtrArray SubTalarPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
};

LegCalibrationStudy LegCalibration3Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
  {&..BodyModel.Right.Leg.Mus, &..BodyModel.Trunk.Muscles.Right,},
    {
      "Iliacus*.*",
      "Psoas*.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(HipPositions);
  AnyObjectPtrArray HipPositions = repmat(2,{
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.Flexed,
    &.RangeOfMotion.Right.Leg.Hip.Extended,
    &.RangeOfMotion.Right.Leg.Hip.ExtendedAndAdducted,
  });
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
  AnyObjectPtrArray SubTalarPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
};

LegCalibrationStudy LegCalibration4Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "RectusFem*.*",
      "BicepsFem*.*",
      "Semitend*.*",
      "Semimem*.*",
      "Sartorius.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(HipPositions);
  AnyObjectPtrArray HipPositions = repmat(2,{
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAbducted,
    &.RangeOfMotion.Right.Leg.Hip.AbductedAndExternallyRotated,
    &.RangeOfMotion.Right.Leg.Hip.Extended,
    &.RangeOfMotion.Right.Leg.Hip.ExtendedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.ExternallyRotated,
  });
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
  AnyObjectPtrArray SubTalarPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
};

LegCalibrationStudy LegCalibration5Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "Vastus*.*",
      "Popliteus.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(HipPositions);
  AnyObjectPtrArray HipPositions = repmat(2,{
    &.RangeOfMotion.Right.Leg.Hip.Neutral,
    &.RangeOfMotion.Right.Leg.Hip.FlexedAndAdducted,
    &.RangeOfMotion.Right.Leg.Hip.Extended,
  });
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
  AnyObjectPtrArray SubTalarPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Ankle.Neutral);
};

LegCalibrationStudy LegCalibration6Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "TibialisAnt*.*",
      "TibialisPosteriorMed*.*",
      "ExtensorDigi*.*",
      "ExtensorHall*.*",
      "FlexorDigi*.*",
      "FlexorHall*.*",
      "Peroneus*.*",
      "Plantaris.*",
      "Gastroc*.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMinDefault);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), .RValues.RMaxDefault);
  
  AnyInt nPos = NumElemOf(AnklePositions);
  AnyObjectPtrArray HipPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Hip.Neutral);
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = flatten(repmat(2, {
    &.RangeOfMotion.Right.Leg.Ankle.MaxPlantarFlexionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxDorsiFlexionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
  }));
  AnyObjectPtrArray SubTalarPositions = flatten(repmat(2, {
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxInversionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxEversionAngle,
  }));
};

LegCalibrationStudy LegCalibration7Right(
  BodyModelRef=Main.HumanModel.BodyModel,
  Side=Right,
) = {
  nStep = nPos;
  
  MuscleArr = ObjSearch(
    &..BodyModel.Right.Leg.Mus,
    {
      "TibialisPosteriorLat*.*",
      "Soleus*.*",
    }, 
    "AnyMuscle"
  );
  
  RminMuscleFiber = repmat(NumElemOf(MuscleArr), 1.0);
  RmaxMuscleFiber = repmat(NumElemOf(MuscleArr), 1.2);
  
  AnyInt nPos = NumElemOf(AnklePositions);
  AnyObjectPtrArray HipPositions = repmat(nPos, &.RangeOfMotion.Right.Leg.Hip.Neutral);
  AnyObjectPtrArray KneePositions = flatten({
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxFlexionAngle),
    repmat(round(nPos/2), &.RangeOfMotion.Right.Leg.Knee.MaxExtensionAngle)
  });
  AnyObjectPtrArray AnklePositions = flatten(repmat(2, {
    &.RangeOfMotion.Right.Leg.Ankle.MaxPlantarFlexionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxDorsiFlexionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
  }));
  AnyObjectPtrArray SubTalarPositions = flatten(repmat(2, {
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxInversionAngle,
    &.RangeOfMotion.Right.Leg.Ankle.Neutral,
    &.RangeOfMotion.Right.Leg.Ankle.MaxEversionAngle,
  }));
};

CalibrationSequence = {
  AnyOperation &Cal1Right = .LegCalibration1Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal2Right = .LegCalibration2Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal3Right = .LegCalibration3Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal4Right = .LegCalibration4Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal5Right = .LegCalibration5Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal6Right = .LegCalibration6Right.FiberAndTendonLengthAdjustment;
  AnyOperation &Cal7Right = .LegCalibration7Right.FiberAndTendonLengthAdjustment;  
};