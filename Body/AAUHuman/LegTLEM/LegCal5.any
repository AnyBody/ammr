//This is the calibration4 file, it will calibrate specific muscles of the leg
AnyFolder LegCal5={
  
  AnyFolder &Pelvis = ...HumanFolderRef.Trunk.SegmentsLumbar.PelvisSeg;
  AnyFolder &Sacrum = ...HumanFolderRef.Trunk.SegmentsLumbar.SacrumSeg;
  
  AnyFolder &LegSegSide = .SideHumanFolderRef.Leg.Seg;
  
  AnyFolder &LegJointsSide = .SideHumanFolderRef.Leg.Jnt;
  AnyFolder &SacrumPelvisJnt = ...HumanFolderRef.Trunk.JointsLumbar.SacrumPelvisJnt;

#if BM_LEG_MORPHOLOGY == 1
  AnyFolder &JointsCal2 = .SideHumanFolderRef.Leg.Jnt; 
#endif
#if BM_LEG_MORPHOLOGY == 2
  AnyFolder &JointsCal5 = .SideHumanFolderRef.Leg.Jnt;
#endif
  
  AnyFixedRefFrame ground = {
    AnyRefNode node = { 
      ARel=..Pelvis.Axes0;
      sRel=..Pelvis.r0;
    };
  };
  
  AnyRevoluteJoint PelvisGround={
    AnyRefFrame &Ground = .ground.node;
    AnySeg &Sacrum= ....HumanFolderRef.Trunk.SegmentsLumbar.PelvisSeg; 
    Axis=z;
  };
  
  AnyKinEqSimpleDriver PelvisGroundRot = {
    AnyRevoluteJoint &Jnt = .PelvisGround;
    DriverPos = {0};
    DriverVel = {0};
    Reaction.Type = {Off}; 
  };
  
  AnyKinEqSimpleDriver PelvisSacrumFix = {
    AnyKinMeasure &Jnt = .SacrumPelvisJnt;
    DriverPos = {0,0,0};
    DriverVel = {0,0,0};
    Reaction.Type = {Off,Off,Off}; 
  }; 
  
  AnyKinEqSimpleDriver Hip = {
#if BM_LEG_MORPHOLOGY == 1
    AnySphericalJoint &Spherical = .LegJointsSide.Hip;
#endif
#if BM_LEG_MORPHOLOGY == 2
    AnySphericalJoint &Spherical = .JointsCal5.Hip;
#endif
    MeasureOrganizer = {2,0,1}; // flexion/extension, abduction/adduction, internal/external rotation
    DriverPos = {-60,0,..Sign*10}*pi/180;
    DriverVel = {0,0,0}*pi/180;
    Reaction.Type = {Off,Off,Off};
  };
    
  AnyKinEqSimpleDriver Knee = {
    AnyRevoluteJoint &Hinge = .LegJointsSide.Knee;
    DriverPos = {-50*pi/180};
    DriverVel = {0*pi/180};
    Reaction.Type = {Off};
  };
    
  AnyKinEqSimpleDriver Ankle = {
    AnyRevoluteJoint &Hinge = .LegJointsSide.Ankle;
    DriverPos = {10*pi/180}; // 10 degrees dorsi flexion
    DriverVel = {0*pi/180};
    Reaction.Type = {Off};
  };

  AnyKinEqSimpleDriver SubTalar = {
    AnyRevoluteJoint &Hinge = .LegJointsSide.SubTalar;
    DriverPos = {-20*pi/180};
    DriverVel = {0*pi/180}; 
    Reaction.Type = {Off};
  };
  
  //AnyFolder &MuscleParCal5 =.SideHumanFolderRef.Leg.MusPar;
  
  AnyFolder Mus = { 
    //Muscle main function: knee extension
    AnyShortestPathMuscle &VastusLateralisInferior1 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior1;
    AnyShortestPathMuscle &VastusLateralisInferior2 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior2;
    AnyShortestPathMuscle &VastusLateralisInferior3 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior3;
    AnyShortestPathMuscle &VastusLateralisInferior4 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior4;
    AnyShortestPathMuscle &VastusLateralisInferior5 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior5;
    AnyShortestPathMuscle &VastusLateralisInferior6 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisInferior6;
    AnyShortestPathMuscle &VastusLateralisSuperior1 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisSuperior1;
    AnyShortestPathMuscle &VastusLateralisSuperior2 = ..SideHumanFolderRef.Leg.Mus.VastusLateralisSuperior2;
    
    AnyShortestPathMuscle &VastusMedialisInferior1 =..SideHumanFolderRef.Leg.Mus.VastusMedialisInferior1;
    AnyShortestPathMuscle &VastusMedialisInferior2 =..SideHumanFolderRef.Leg.Mus.VastusMedialisInferior2;
    AnyShortestPathMuscle &VastusMedialisMid1 =..SideHumanFolderRef.Leg.Mus.VastusMedialisMid1;
    AnyShortestPathMuscle &VastusMedialisMid2 =..SideHumanFolderRef.Leg.Mus.VastusMedialisMid2;
    AnyShortestPathMuscle &VastusMedialisSuperior1 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior1;
    AnyShortestPathMuscle &VastusMedialisSuperior2 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior2;
    AnyShortestPathMuscle &VastusMedialisSuperior3 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior3;
    AnyShortestPathMuscle &VastusMedialisSuperior4 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior4;
#if BM_LEG_MORPHOLOGY == 1
    AnyShortestPathMuscle &VastusMedialisSuperior5 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior5;
    AnyShortestPathMuscle &VastusMedialisSuperior6 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior6;
    //AnyViaPointMuscle &VastusMedialisSuperior5 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior5; //JDT-2015.03.24: Added as comments, as these were in a non-active TLEM morphology 1 block in the TLEMsafe 2.0 Trunk. PEG should review.
    //AnyViaPointMuscle &VastusMedialisSuperior6 =..SideHumanFolderRef.Leg.Mus.VastusMedialisSuperior6; //JDT-2015.03.24: Added as comments, as these were in a non-active TLEM morphology 1 block in the TLEMsafe 2.0 Trunk. PEG should review.
#endif

    AnyShortestPathMuscle &VastusIntermedius1 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius1;
    AnyShortestPathMuscle &VastusIntermedius2 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius2;
    AnyShortestPathMuscle &VastusIntermedius3 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius3;
    AnyShortestPathMuscle &VastusIntermedius4 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius4;
    AnyShortestPathMuscle &VastusIntermedius5 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius5;
    AnyShortestPathMuscle &VastusIntermedius6 = ..SideHumanFolderRef.Leg.Mus.VastusIntermedius6;
    
#if BM_LEG_MORPHOLOGY == 1
    AnyViaPointMuscle &TensorFasciaeLatae1 = ..SideHumanFolderRef.Leg.Mus.TensorFasciaeLatae1;
    AnyViaPointMuscle &TensorFasciaeLatae2 = ..SideHumanFolderRef.Leg.Mus.TensorFasciaeLatae2;

//    AnyViaPointMuscle &RectusFemoris1 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris1; //JDT-2015.03.24: Added as comments, as these were in a non-active TLEM morphology 1 block in the TLEMsafe 2.0 Trunk. PEG should review.
//    AnyViaPointMuscle &RectusFemoris2 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris2; //JDT-2015.03.24: Added as comments, as these were in a non-active TLEM morphology 1 block in the TLEMsafe 2.0 Trunk. PEG should review.
    AnyShortestPathMuscle &RectusFemoris1 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris1;
    AnyShortestPathMuscle &RectusFemoris2 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris2;
#endif
#if BM_LEG_MORPHOLOGY == 2
    AnyShortestPathMuscle &RectusFemoris1 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris1;
    AnyShortestPathMuscle &RectusFemoris2 = ..SideHumanFolderRef.Leg.Mus.RectusFemoris2;
#endif    
    
#if BM_LEG_MORPHOLOGY == 1
    AnyViaPointMuscle &ObturatorExternusSuperior1 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior1;
    AnyViaPointMuscle &ObturatorExternusSuperior2 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior2;
    AnyViaPointMuscle &ObturatorExternusSuperior3 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior3;
    AnyViaPointMuscle &ObturatorExternusInferior1 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusInferior1;
    AnyViaPointMuscle &ObturatorExternusInferior2 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusInferior2;
    AnyViaPointMuscle &ObturatorInternus1 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus1;
    AnyViaPointMuscle &ObturatorInternus2 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus2;
    AnyViaPointMuscle &ObturatorInternus3 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus3;
#endif
#if BM_LEG_MORPHOLOGY == 2
//    
//    AnyViaPointMuscle &ObturatorExternusSuperior1 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior1;
//    AnyViaPointMuscle &ObturatorExternusSuperior2 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior2;
//    AnyViaPointMuscle &ObturatorExternusSuperior3 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusSuperior3;
//    AnyViaPointMuscle &ObturatorExternusInferior1 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusInferior1;
//    AnyViaPointMuscle &ObturatorExternusInferior2 = ..SideHumanFolderRef.Leg.Mus.ObturatorExternusInferior2;
//    AnyViaPointMuscle &ObturatorInternus1 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus1;
//    AnyViaPointMuscle &ObturatorInternus2 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus2;
//    AnyViaPointMuscle &ObturatorInternus3 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus3;
//    AnyViaPointMuscle &ObturatorInternus4 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus4;
//    AnyViaPointMuscle &ObturatorInternus5 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus5;
//    AnyViaPointMuscle &ObturatorInternus6 = ..SideHumanFolderRef.Leg.Mus.ObturatorInternus6;
#endif    
  
    AnyViaPointMuscle &PeroneusBrevis1  = ..SideHumanFolderRef.Leg.Mus.PeroneusBrevis1;
    AnyViaPointMuscle &PeroneusBrevis2  = ..SideHumanFolderRef.Leg.Mus.PeroneusBrevis2;
    AnyViaPointMuscle &PeroneusBrevis3  = ..SideHumanFolderRef.Leg.Mus.PeroneusBrevis3;
    AnyViaPointMuscle &PeroneusLongus1  = ..SideHumanFolderRef.Leg.Mus.PeroneusLongus1;
    AnyViaPointMuscle &PeroneusLongus2  = ..SideHumanFolderRef.Leg.Mus.PeroneusLongus2;
    AnyViaPointMuscle &PeroneusLongus3  = ..SideHumanFolderRef.Leg.Mus.PeroneusLongus3;
  };
  
};

// The study: Operations to be performed on the model
AnyBodyCalibrationStudy LegCalibrationStudy5 = {
  AnyFolder &ref=.LegCal5; 
  nStep = 1;
  InitialConditions.SolverType = KinSolOverDeterminate;
};
