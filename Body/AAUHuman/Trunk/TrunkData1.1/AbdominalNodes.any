#include "AbdominalShrinkPoints.any"

/// Discretizationfactor used to define number of points for volumes and inertia
AnyInt DiscretizationFactor = CAVITY_DISCRETIZATION;
 #define Experimental_Volume_Geo

/// Defines the number of points to distribute on the posterior part of the abdominal layers
/// Needs to be a minium of 2
AnyInt DiscretizationPosterior = max({floor(DiscretizationFactor * 20 / 33), 2});

/// Defines the number of points to distribute on the anterior part of the abdominal layers
/// Needs to be min 2
AnyInt DiscretizationAnterior = DiscretizationFactor - DiscretizationPosterior;

#ifdef Experimental_Volume_Geo

AnyFloat P0_R = {0.05298804, 0.1248715, 0.1235282};  //point on rib 11
   AnyFloat P1_R = {0.06630481, 0.03350896, 0.1065704}+{0.0,0.0,0.03};  //point on pelvis illiac_crest
   AnyFloat P0_L = {P0_R[0],P0_R[1],-P0_R[2]};  //point on rib 11   


AnyFloat P1_L = {P1_R[0],P1_R[1],-P1_R[2]};  //point on rib 11
   AnyFloat P0_Mid = {0.150,  0.16, 0}; 
   AnyFloat P1_Mid = {0.1363476, -0.1395665, 0};//{0.147, -0.045, 0}; //{0.14-0.0, -0.05 , 0};
 
   
   
//   AnyFolder Visualization ={
//     AnySeg &R11_R =Main.HumanModel.BodyModel.Trunk.Segments.Right.R11Seg;
//     R11_R ={AnyRefNode VolumeControlNode ={sRel =.Scale(...P0_R); AnyDrawRefFrame drw ={RGB={0,0,1};};};};
//     AnySeg &R11_L =Main.HumanModel.BodyModel.Trunk.Segments.Left.R11Seg;
//     R11_L ={AnyRefNode VolumeControlNode ={sRel =.Scale(...P0_L); AnyDrawRefFrame drw ={RGB={0,0,1};};};};
//     AnySeg &Pelvis =Main.HumanModel.BodyModel.Trunk.Segments.Right.PelvisSeg;
//     Pelvis={
//       AnyRefNode VolumeControlNodeR ={sRel =.Scale(...P1_R); AnyDrawRefFrame drw ={RGB={0,0,1};};};
//       AnyRefNode VolumeControlNodeL ={sRel =.Scale(...P1_L); AnyDrawRefFrame drw ={RGB={0,0,1};};};
//       AnyRefNode VolumeControlNode ={sRel =.Scale(...P1_Mid); AnyDrawRefFrame drw ={RGB={0,0,1};};};
//     };
//     AnySeg &Sternum=  Main.HumanModel.BodyModel.Trunk.Segments.SternalBodySeg;
//     Sternum ={
//       AnyRefNode VolumeControlNode ={sRel =.Scale(...P0_Mid); AnyDrawRefFrame drw ={RGB={0,0,1};};};
//     };
//     
//     AnyFixedRefFrame Global ={
//       AnyDrawLine LineR ={
//         p0=..R11_R.VolumeControlNode.r;
//         p1=..Pelvis.VolumeControlNodeR.r;       
//         Line.Thickness=.005; Line.RGB={0,0,1};
//       };
//       AnyDrawLine LineL ={
//         p0=..R11_L.VolumeControlNode.r;
//         p1=..Pelvis.VolumeControlNodeL.r;       
//         Line.Thickness=.005; Line.RGB={0,0,1};
//       };
//       AnyDrawLine LineMid ={
//         p0=..Sternum.VolumeControlNode.r;
//         p1=..Pelvis.VolumeControlNode.r;       
//         Line.Thickness=.005; Line.RGB={0,0,1};
//         
//       };
//
//     };
//     
//   };
   
 #endif
AnyFolder Layer_Pelvic5 ={
  AnyVec3 Origin ={0.0,-0.160,0};
  
  AnyFolder InertiaPoints={
    AnyVec3 node00_R = {0.1343438877825569, -0.16000000, 0.00060080117794883078} ;
    AnyVec3 node01_R = {0.078858843215331681,-0.16000000, 8.6337680896518891e-10};
    AnyVec3 node02_R = {0.022772561914734715, -0.16000000, 4.3184312330064717e-10};
    AnyVec3 node03_R = {-0.033313719385862139, -0.16000000, 3.0943763610636444e-13};
    AnyVec3 node04_R = {-0.03341371938586235, -0.16000000, -4.5997277167697526e-13};
    AnyVec3 node05_R = {-0.029679381559135503, -0.160000000, 0.056127410985126955};
    AnyVec3 node06_R = {-0.0015110061481333238, -0.16000000, 0.10048432308716559};
    AnyVec3 node07_R = {0.047838427180502928, -0.16000000, 0.12713585925812923};
    AnyVec3 node08_R = {0.097945784835716476, -0.16000000, 0.15159572390573789};
    AnyVec3 node09_R = {0.13090987454516809, -0.16000000, 0.11268165098553865};
    AnyVec3 node10_R = {0.13393862548911986,-0.16000000, 0.05667720814526743};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =1;
      AnyVar Anterior_Spline_Start =0;
      AnyVar Anterior_Spline_End =1;
      
      //create a spline function
      Parametric.Fun.Data= {
        
        {0.01658628, -0.16000000, -4.599728e-13}+{-0.02,0,0},
        {-0.03967938, -0.16000000, -0.003872589}+{0.03,0,0},
        {-0.02151101, -0.16000000, 0.02048432}+{0.03,0,0},
        {-0.01216157, -0.16000000, 0.023713586}+{0.03,0,0},
        {0.04794578, -0.16000000, 0.0515957}+{-0.03,0,-0.03},
        {0.08090987, -0.16000000, 0.05268165}+{-0.04,0,-0.03},
        { 0.09393863, -0.16000000, 0.02667721}+{-0.03,0,-0.01},
        {0.1043439, -0.16000000, 0.0006008012}+{-0.03,0,0}
      }';
      #include "InterpolFunWithSPar.any"
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };
  
  
  
};

AnyFolder Layer_Pelvic4 ={
  AnyFloat Origin ={0.0,-0.1260,0};
  
  AnyFolder InertiaPoints={
    AnyVec3 node00_R = {0.1343438877825569, -0.12600446138741439, 0.00060080117794883078} ;
    AnyVec3 node01_R = {0.078858843215331681, -0.12600446138741439, 8.6337680896518891e-10};
    AnyVec3 node02_R = {0.022772561914734715, -0.12600446138741439, 4.3184312330064717e-10};
    AnyVec3 node03_R = {-0.033313719385862139, -0.12600446138741439, 3.0943763610636444e-13};
    AnyVec3 node04_R = {-0.03341371938586235, -0.12600446138741439, -4.5997277167697526e-13};
    AnyVec3 node05_R = {-0.029679381559135503, -0.12600446138741439, 0.056127410985126955};
    AnyVec3 node06_R = {-0.0015110061481333238,-0.12600446138741439, 0.10048432308716559};
    AnyVec3 node07_R = {0.047838427180502928, -0.12600446138741439, 0.12713585925812923};
    AnyVec3 node08_R = {0.097945784835716476, -0.12600446138741439, 0.15159572390573789};
    AnyVec3 node09_R = {0.13090987454516809, -0.12600446138741439, 0.11268165098553865};
    AnyVec3 node10_R = {0.13393862548911986, -0.12600446138741439, 0.05667720814526743};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      
      //create a spline function
      Parametric.Fun.Data= {
        
        {-0.03341371938586235, -0.12600446138741439, -4.5997277167697526e-13} + {0.01,0,0},
        {-0.029679381559135503, -0.12600446138741439, 0.056127410985126955}+ {-0.01+0.01,0,-0.06},
        {-0.0015110061481333238, -0.12600446138741439, 0.10048432308716559}+ {-0.02,0,-0.07}+{0.0,0,-0.01} ,
        {0.047838427180502928, -0.12600446138741439, 0.12713585925812923}+ {-0.01,0,-0.08}+{-0.05,0,0} +{0.03,0,-0.01} ,
        {0.097945784835716476, -0.12600446138741439, 0.15159572390573789}+ {0,0,-0.08}+{-0.05,0,0} +{0.0,0,-0.02} ,
        {0.13090987454516809, -0.12600446138741439, 0.11268165098553865}+{0,0,-0.05}+{-0.05,0,0} +{0.0,0,-0.01} ,
        {0.13393862548911986, -0.12600446138741439, 0.05667720814526743}+{0.01,0,0}+{-0.05,0,0} +{0.0,0,-0.03} +{0.015,0,0},
        {0.1343438877825569, -0.12600446138741439, 0.00060080117794883078}+{0.02,0,0}+{-0.05,0,0}+{0.01,0,0}
      }';
      #include "InterpolFunWithSPar.any"
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };
  
  
  
};

AnyFolder Layer_Pelvic3 ={
  AnyFloat Origin ={0.0,-0.0860,0};
  
  AnyFolder InertiaPoints={
    AnyVec3 node00_R = {0.1343438877825569, -0.08600461, 0.00060080117794883078};
    AnyVec3 node01_R = {0.078858843215331681, -0.08600461, 8.6337680896518891e-10};
    AnyVec3 node02_R = {0.022772561914734715, -0.08600461, 4.3184312330064717e-10};
    AnyVec3 node03_R = {-0.033313719385862139, -0.08600461, 3.0943763610636444e-13};
    AnyVec3 node04_R = {-0.03341371938586235, -0.08600461, -4.5997277167697526e-13} ;
    AnyVec3 node05_R = {-0.029679381559135503, -0.08600461, 0.056127410985126955};
    AnyVec3 node06_R = {-0.0015110061481333238, -0.08600461, 0.10048432308716559};
    AnyVec3 node07_R = {0.047838427180502928, -0.08600461, 0.12713585925812923};
    AnyVec3 node08_R = {0.097945784835716476, -0.08600461, 0.15159572390573789};
    AnyVec3 node09_R = {0.13090987454516809, -0.08600461, 0.11268165098553865};
    AnyVec3 node10_R = {0.13393862548911986, -0.08600461, 0.05667720814526743};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={ 
    AnyFolder Right = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      
      //create a spline function
      Parametric.Fun.Data= {
        {-0.043413720000000003, -0.086004609999999995, 0.0},
        {-0.049397123441309448, -0.086004609999999995, -0.0038725890000000001},
        {-0.032047193462627833, -0.086004609999999995, 0.030484319999999999},
        {0.005529646149408568, -0.086004609999999995, 0.047135860000000002},
        {0.062929311162393781, -0.086004609999999995, 0.091595720000000005},
        {0.0944084792674003, -0.086004609999999995, 0.092681650000000004},
        {0.11806599287384113, -0.086004609999999995, 0.056677209999999999},
        {0.12619899755147757, -0.086004609999999995, 0.00060080120000000005}
      }';
      #include "InterpolFunWithSPar.any"
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };  
  };
  
  
  
};

AnyFolder Layer_Pelvic2 ={
  AnyFloat Origin ={0.0,-0.0460,0};
  
  AnyFolder InertiaPoints={
    AnyVec3 node00_R = {0.1343438877825569,  -0.04600289, 0.00060080117794883078};
    AnyVec3 node01_R = {0.078858843215331681,  -0.04600289, 8.6337680896518891e-10};
    AnyVec3 node02_R = {0.022772561914734715,  -0.04600289, 4.3184312330064717e-10};
    AnyVec3 node03_R = {-0.033313719385862139,  -0.04600289, 3.0943763610636444e-13};
    AnyVec3 node04_R = {-0.03341371938586235,  -0.04600289, -4.5997277167697526e-13};
    AnyVec3 node05_R = {-0.029679381559135503,  -0.04600289, 0.056127410985126955};
    AnyVec3 node06_R = {-0.0015110061481333238,0.04600289, 0.10048432308716559};
    AnyVec3 node07_R = {0.047838427180502928,  -0.04600289, 0.12713585925812923};
    AnyVec3 node08_R = {0.097945784835716476,  -0.04600289, 0.15159572390573789};
    AnyVec3 node09_R = {0.13090987454516809,  -0.04600289, 0.11268165098553865};
    AnyVec3 node10_R = {0.13393862548911986,  -0.04600289, 0.05667720814526743};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      
      Parametric.Fun.Data= 
      {
        {0.016586279999999998, -0.01, 0.0},
        {-0.0071045364790172996, -0.01, 0.056127410000000003},
        {0.0092827783185992704, -0.01, 0.040484319999999997},
        {0.031245215346314921, -0.01, 0.057135859999999997},
        {0.085460188135009732, -0.01, 0.13659569999999999},
        {0.12325796613557381, -0.01, 0.10431},
        {0.12941586418066253, -0.01, 0.07044454},
        {0.13615366204165388, -0.01, 0.00060080120000000005}
      }';
      
      
      #include "InterpolFunWithSPar.any"
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };    
  };
  
  
};

AnyFolder Layer_L5 ={
  AnyFloat Origin ={0.0,-0.0460,0} + {0, 0.03, 0} ;
  
  AnyFolder InertiaPoints={
    AnyVec3 node00_R = {0.1343438877825569, 0.01908622, 0.00060080117794883078};
    AnyVec3 node01_R = {0.078858843215331681, 0.01908622, 8.6337680896518891e-10};
    AnyVec3 node02_R = {0.022772561914734715, 0.01908622, 4.3184312330064717e-10};
    AnyVec3 node03_R = {-0.033313719385862139, 0.01908622, 3.0943763610636444e-13};
    AnyVec3 node04_R = {-0.03341371938586235, 0.01908622, -4.5997277167697526e-13};
    AnyVec3 node05_R = {-0.029679381559135503, 0.01908622, 0.056127410985126955};
    AnyVec3 node06_R = {-0.0015110061481333238, 0.01908622, 0.10048432308716559};
    AnyVec3 node07_R = {0.047838427180502928, 0.01908622, 0.12713585925812923};
    AnyVec3 node08_R = {0.097945784835716476, 0.01908622, 0.15159572390573789};
    AnyVec3 node09_R = {0.13090987454516809, 0.01908622, 0.11268165098553865};
    AnyVec3 node10_R = {0.13393862548911986, 0.01908622, 0.05667720814526743};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={ 
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      
      #ifndef Experimental_Volume_Geo
     
      
      Parametric.Fun.Data= {{1,0,0},{0,1,0},{0,0,0.80}}*{
        {0.07658628, 0.01908622, 0}, 
        {0.02032062, 0.01908622, 0.05612741}, 
        {0.04848899, 0.01908622, 0.08048432}, 
        {0.05783843, 0.01908622, 0.09213586}, 
        {0.09928567, 0.01908622, 0.149107}, 
        {0.1309099, 0.01908622, 0.1226817}, 
        {0.1505707, 0.01703068, 0.06164054}, 
        {0.1473467, 0.0093245, -0.0004378972}
      }';
      
      
      
      #endif

      #ifdef Experimental_Volume_Geo
      
      AnyFolder EllipsoidCalculation ={
        
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L5.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L5.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_R;
        AnyFloat P1 =....P1_R;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;
         
        AnyVar Angle1 = pi/4;
        AnyVar Angle2 = -20*pi/180;

        #include "PointOnLineCal.any"
      };
      
      AnyFloat  PickedPoints= ({{1,0,0},{0,1,0},{0,0,0.80}}*{
        {0.07658628, 0.01908622, 0}, 
        {0.02032062, 0.01908622, 0.05612741}, 
        {0.04848899, 0.01908622, 0.08048432+0.01}, 
      }')';
      
      AnyInt size = SizesOf(PickedPoints)[0];  //number of picked points
      AnyFloat CalculatedPoints =reshape(  take(EllipsoidCalculation.Cal.CalculatedPoints,iarr(size*3,1,8*3-1)),{(8-size),3});
      Parametric.Fun.Data =(arrcat(PickedPoints,CalculatedPoints))';
      
      
      #endif
      
      
      
      #include "InterpolFunWithSPar.any" 
      
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
      
      AnyFolder EllipsoidCalculation ={
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L5.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L5.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_L;
        AnyFloat P1 =....P1_L;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;

  AnyVar Angle1 = pi-..Right.EllipsoidCalculation.Angle1;
  AnyVar Angle2 = pi-..Right.EllipsoidCalculation.Angle2;


        #include "PointOnLineCal.any"
      };

      
      
      
    };  
  };
  
  
};

AnyFolder Layer_L4 ={
  AnyFolder InertiaPoints={
    
    
    AnyVec3 node00_R = {0.13604431444436915, 0.051298342643788825, 1.65063238247495e-09};
    AnyVec3 node01_R = {0.078484382124944574, 0.051298342643788825, 1.1004883761799488e-09};
    AnyVec3 node02_R = {0.020924449805520107, 0.051298342643788825, 5.5034436988494849e-10};
    AnyVec3 node03_R = {-0.036635482513904583, 0.051298342643788825, 2.0036358994608477e-13};
    AnyVec3 node04_R = {-0.036735482513904572, 0.051298342643788825, -7.5541238845830416e-13};
    AnyVec3 node05_R = {-0.032220554389494727, 0.051298342643788825, 0.057830373152214606};
    AnyVec3 node06_R = {-0.0034729526315421268, 0.051298342643788825, 0.10374904555813266};
    AnyVec3 node07_R = {0.04717312282940004, 0.051298342643788825, 0.13110084347017661};
    AnyVec3 node08_R = {0.0998298834706111, 0.051298342643788825, 0.15156295939428677}+{0,0,-0.01};
    AnyVec3 node09_R = {0.13616763991143496, 0.051298342643788825, 0.11182873645883647};
    AnyVec3 node10_R = {0.13921326116014349, 0.051298342643788825, 0.054350944157562774};
    AnyVec3 node11_R = node00_R;
  };
  
  AnyFolder AbdominalCavityPoints={    
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
    
      #ifndef Experimental_Volume_Geo

      //create a spline function
      Parametric.Fun.Data=      {{1,0,0},{0,1,0},{0,0,0.80}}* {
        
        {0.07326452, 0.051298342643788825, -7.5541238845830416e-13},
        {0.007779446, 0.051298342643788825, 0.057830373152214606},
        {0.037882518662136842, 0.051298342643787936, 0.091039173225461165},
        {0.067173122829400037, 0.051298342643788825, 0.10443758986418356},
        {0.098415736460262554, 0.052286843786936293, 0.14925373873038061},
        {0.13050478895277193, 0.051298342643788818, 0.12715488336469266},
        {0.14882041618297187, 0.051298342643788825, 0.059350944157562771},
        {0.1510443, 0.051298342643788825, 1.65063238247495e-09}
      }';
      #endif
      #ifdef Experimental_Volume_Geo

      AnyFolder EllipsoidCalculation ={

          //use height of layer... this is the node connecting on vertebrae
          AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L4.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L4.Left.Transversus_Ins_pos[1]);
          AnyFloat P0 =....P0_R;
          AnyFloat P1 =....P1_R;
          AnyFloat P0_Mid =....P0_Mid;
          AnyFloat P1_Mid =....P1_Mid;

  AnyVar Angle1 = pi/4;
  AnyVar Angle2 = -20*pi/180;

          #include "PointOnLineCal.any"
      };
      
     AnyFloat    PickedPoints=      ({{1,0,0},{0,1,0},{0,0,0.9}}* {
        {0.07326452, 0.051298342643788825, -7.5541238845830416e-13},
        {0.007779446, 0.051298342643788825, 0.057830373152214606},
        {0.037882518662136842, 0.051298342643787936, 0.091039173225461165+0.005},
      }')';

   AnyInt size = SizesOf(PickedPoints)[0];  //number of picked points
   AnyFloat CalculatedPoints =reshape(  take(EllipsoidCalculation.Cal.CalculatedPoints,iarr(size*3,1,8*3-1)),{(8-size),3});
   Parametric.Fun.Data =(arrcat(PickedPoints,CalculatedPoints))';

      
      
#endif
      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
      
      AnyFolder EllipsoidCalculation ={
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L4.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L4.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_L;
        AnyFloat P1 =....P1_L;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;
        
  AnyVar Angle1 = pi-..Right.EllipsoidCalculation.Angle1;
  AnyVar Angle2 = pi-..Right.EllipsoidCalculation.Angle2;

        #include "PointOnLineCal.any"
      };

      
    };
  };
  
  
};


AnyFolder Layer_L3 ={
  
  AnyFolder InertiaPoints ={
    AnyVec3 node00_R = {0.13714350170600675,  0.079194621122369427, 1.9933230332764409e-09};
    AnyVec3 node01_R = {0.078109920498452334,  0.079194621122369427, 1.3289069009959213e-09};
    AnyVec3 node02_R = {0.019076339290897915,  0.079194621122369427, 6.6449076871540129e-10};
    AnyVec3 node03_R = {-0.039957241916656727,  0.079194621122369427, 7.4636434878827143e-14};
    AnyVec3 node04_R = {-0.040057241916656494,  0.079194621122369427, -1.0508520052396331e-12};
    AnyVec3 node05_R = {-0.034761727066914744,  0.079194621122369427, 0.059533336885375737};
    AnyVec3 node06_R = {-0.0054348966648404516,  0.079194621122369427, 0.10701376170577383};
    AnyVec3 node07_R = {0.046507817958612606,  0.079194621122369427, 0.13506582237402848};
    AnyVec3 node08_R = {0.10165734100747088,  0.079194621122369427, 0.15098915934337337};
    AnyVec3 node09_R = {0.14130471997409674,  0.079194621122369427, 0.1109614489921035};
    AnyVec3 node10_R = {0.1441244144499251,  0.079194621122369427, 0.052014833589894338};
    AnyVec3 node11_R = node00_R;
  }; 
  AnyFolder AbdominalCavityPoints ={
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      
      #ifndef Experimental_Volume_Geo

      //create a spline function
      Parametric.Fun.Data=       {{1,0,0},{0,1,0},{0,0,0.80}}*{
        {0.069942758083343506, 0.079194621122369427, -1.0508520052396331e-12},
        {0.0097785144901598384, 0.07776836757736684, 0.057693684945731766}, 
        {0.027955892520707223, 0.075676727551228951, 0.10445590689114506}, 
        {0.067423136745155987, 0.079194621122369427, 0.1159754071471791},
        {0.10420519479998439, 0.079194621122370315, 0.14909995838960649}, 
        {0.14176132798465324, 0.079194621122369427, 0.1095369693288514},
        {0.14675172548745358, 0.077103902122726567, 0.056798137608705217}, 
        {0.15514350170600677, 0.079194621122369427, 1.9933230332764409e-09}
      }';
      #endif
      #ifdef Experimental_Volume_Geo
AnyFolder EllipsoidCalculation ={

          //use height of layer... this is the node connecting on vertebrae
          AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L3.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L3.Left.Transversus_Ins_pos[1]);
          AnyFloat P0 =....P0_R;
          AnyFloat P1 =....P1_R;
          AnyFloat P0_Mid =....P0_Mid;
          AnyFloat P1_Mid =....P1_Mid;

  AnyVar Angle1 = pi/4;
  AnyVar Angle2 = -20*pi/180;

          #include "PointOnLineCal.any"

        
        
        
        };

      
       AnyFloat    PickedPoints=      ({{1,0,0},{0,1,0},{0,0,0.80}}*{
        {0.069942758083343506, 0.079194621122369427, -1.0508520052396331e-12},
        {0.0097785144901598384, 0.07776836757736684, 0.057693684945731766+0.01}, 
        {0.027955892520707223, 0.075676727551228951, 0.10445590689114506+0.015}, 
      }')';

   AnyInt size = SizesOf(PickedPoints)[0];  //number of picked points
   AnyFloat CalculatedPoints =reshape(  take(EllipsoidCalculation.Cal.CalculatedPoints,iarr(size*3,1,8*3-1)),{(8-size),3});
   Parametric.Fun.Data =(arrcat(PickedPoints,CalculatedPoints))';


      
      
#endif      

      
      #include "InterpolFunWithSPar.any" 
      
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"

      AnyFolder EllipsoidCalculation ={
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L3.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L3.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_L;
        AnyFloat P1 =....P1_L;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;
  AnyVar Angle1 = pi-..Right.EllipsoidCalculation.Angle1;
  AnyVar Angle2 = pi-..Right.EllipsoidCalculation.Angle2;

        #include "PointOnLineCal.any"
      };

    }; 
  };
  
  
  
};



AnyFolder Layer_Diaphragm3 ={
  AnyMat33 S ={{1,0,0},{0,1,0},{0,0,1}};
  AnyVec3 T ={0.05,0,0};
  
  AnyFolder InertiaPoints ={
    AnyVec3 node00_R = {0.1393418742693604, 0.16701791527302604, 2.6460239025380978e-09}+{-0.015,0,0};
    AnyVec3 node01_R = {0.077360995938853483, 0.16701791527302604, 1.7639430745898702e-09};
    AnyVec3 node02_R = {0.015380117608346566, 0.16701791527302604, 8.8186224664164256e-10};
    AnyVec3 node03_R = {-0.046600760722160572, 0.16701791527302604, -2.1858130658855054e-13};
    AnyVec3 node04_R = {-0.046700760722160339, 0.16701791527302604, -1.6417312388022909e-12};
    AnyVec3 node05_R = {-0.039844072485828351, 0.16701791527302604, 0.062939260581131001-0.01};
    AnyVec3 node06_R = {-0.0093117475634637049, 0.16701791527302604, 0.11345929380454584-0.01};
    AnyVec3 node07_R = {0.045177206350299308, 0.16701791527302604, 0.14299577247088507}+{0,0,-0.02-0.01};
    AnyVec3 node08_R = {0.105233387840184, 0.16701791527302604, 0.149438920202936}+{0,0,-0.02-0.01};
    AnyVec3 node09_R = {0.1490597126245711, 0.16701791527302604, 0.1086869253504958}+{-0.015,0,0};
    AnyVec3 node10_R = {0.15394572113977775, 0.16701791527302604, 0.047342607027979759}+{-0.015,0,0};
    
    AnyVec3 node11_R = node00_R;
  };
  AnyFolder AbdominalCavityPoints ={    
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =1;
      
      //create a spline function
      Parametric.Fun.Data=       {{1,0,0},{0,1,0},{0,0,0.90}}*{
        {0.05696932, 0.1766034, -1.641731e-12}, 
        {0.01120877, 0.1729924, 0.06079391}, 
        {0.01194682, 0.1774299, 0.1263826}, 
        {0.06765949, 0.1737384, 0.1345683}, 
        {0.0838397, 0.1757181, 0.1309778}, 
        {0.1116537, 0.1966034, 0.1036869}, 
        {0.1373347, 0.1966034, 0.03745569}, 
        {0.1427883, 0.2166034, 2.646024e-09} 
      }';
      
      
      
      
      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };
  
  AnyFolder AbdominalVolumePoints = {
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      
      //create a spline function
      Parametric.Fun.Data=       {
        (.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')' 
        +      .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')'  ) /2,
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.sRel
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')',
        
        (.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')' 
        +      .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.sRel 
        + 0.9* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.ARel*({-1.5,-1,0}/vnorm({-1.5,-1,0}))')'  )/2    
      }'; 
      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };
  
    AnyFolder AbdominalVolumeUpperPoints = {
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      
      //create a spline function
      Parametric.Fun.Data=       {
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeMid.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral1.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral3.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral5.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral6.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral5.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeLateral3.sRel,
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeMid.sRel
      }'; 
      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };

};


AnyFolder Layer_L2 ={
  AnyFolder InertiaPoints ={
    AnyVec3 node00_R = {0.13824268884481161,  0.10491272993533327, 2.3246542177995858e-09};
    AnyVec3 node01_R = {0.077735458790071599,  0.10491272993533327, 1.5497476094507685e-09};
    AnyVec3 node02_R = {0.017228228735331585,  0.10491272993533327, 7.7484100110195088e-10};
    AnyVec3 node03_R = {-0.043279001319408428,  0.10491272993533327, -6.5607246866712731e-14};
    AnyVec3 node04_R = {-0.043379001319408417,  0.10491272993533327, -1.3462915678108534e-12};
    AnyVec3 node05_R = {-0.037302899657075846,  0.10491272993533327, 0.061236297443263726};
    AnyVec3 node06_R = {-0.0073877482963003831,  0.10491272993533327, 0.11026225493622981};
    AnyVec3 node07_R = {0.0458425141781807,  0.10491272993533327, 0.1390307924007457};
    AnyVec3 node08_R = {0.10345113829101148,  0.10491272993533327, 0.15023659301246012};
    AnyVec3 node09_R = {0.14542125818845406,  0.10491272993533327, 0.10990789249893651};
    AnyVec3 node10_R = {0.14903506423545307,  0.10491272993533327, 0.049678721449187738};
    AnyVec3 node11_R = node00_R;
  };
  AnyFolder AbdominalCavityPoints ={
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;

      #ifndef Experimental_Volume_Geo
      //create a spline function
      Parametric.Fun.Data= 
      
      {{1,0,0},{0,1,0},{0,0,0.80}}*{{0.066621, 0.1049127, -1.346292e-12}, 
        {-0.008818339, 0.1026163, 0.06543794}, 
        {0.03271689, 0.1049127, 0.1090217}, 
        {0.0747903, 0.1049127, 0.1303678}, 
        {0.1034511, 0.1049127, 0.1402366}, 
        {0.1354213, 0.1049127, 0.09490789}, 
        {0.1492168, 0.1043456, 0.05451567}, 
        {0.1582427, 0.1049127, 2.324654e-09}}  ';
    
#endif

#ifdef Experimental_Volume_Geo


AnyFolder EllipsoidCalculation ={

          //use height of layer... this is the node connecting on vertebrae
          AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L2.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L2.Left.Transversus_Ins_pos[1]);
          AnyFloat P0 =....P0_R;
          AnyFloat P1 =....P1_R;
          AnyFloat P0_Mid =....P0_Mid;
          AnyFloat P1_Mid =....P1_Mid;

  AnyVar Angle1 = pi/4;
  AnyVar Angle2 = -20*pi/180;

          #include "PointOnLineCal.any"
      };


       AnyFloat    PickedPoints=      
             ({{1,0,0},{0,1,0},{0,0,0.80}}*{
        {0.066621, 0.1049127, -1.346292e-12}, 
        {-0.008818339, 0.1026163, 0.06543794}, 
        {0.03271689, 0.1049127, 0.1090217}, 
       // {0.0747903, 0.1049127, 0.1303678}, 
       
      }')';

   AnyInt size = SizesOf(PickedPoints)[0];  //number of picked points
   AnyFloat CalculatedPoints =reshape(  take(EllipsoidCalculation.Cal.CalculatedPoints,iarr(size*3,1,8*3-1)),{(8-size),3});
   Parametric.Fun.Data =(arrcat(PickedPoints,CalculatedPoints))';


      
      
#endif
      
      #include "InterpolFunWithSPar.any" 
      
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start =0;
      AnyVar Posterior_Spline_End =0.5;
      AnyVar Anterior_Spline_Start =0.5;
      AnyVar Anterior_Spline_End =1;
      //create a spline function
      Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
      
      AnyFolder EllipsoidCalculation ={
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L2.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L2.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_L;
        AnyFloat P1 =....P1_L;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;
  AnyVar Angle1 = pi-..Right.EllipsoidCalculation.Angle1;
  AnyVar Angle2 = pi-..Right.EllipsoidCalculation.Angle2;

        #include "PointOnLineCal.any"
      };

      
    }; 
  };
  
  
  
  
};

AnyFolder Layer_L1 = {
  AnyFolder InertiaPoints = {
    AnyVec3 node00_R = {0.1393418742693604, 0.13693626021743299, 2.6460239025380978e-09};
    AnyVec3 node01_R = {0.077360995938853483, 0.13693626021743299, 1.7639430745898702e-09};
    AnyVec3 node02_R = {0.015380117608346566, 0.13693626021743299, 8.8186224664164256e-10};
    AnyVec3 node03_R = {-0.046600760722160572, 0.13693626021743299, -2.1858130658855054e-13};
    AnyVec3 node04_R = {-0.046700760722160339, 0.13693626021743299, -1.6417312388022909e-12};
    AnyVec3 node05_R = {-0.039844072485828351, 0.13693626021743299, 0.062939260581131001};
    AnyVec3 node06_R = {-0.0093117475634637049, 0.13693626021743299, 0.11345929380454584};
    AnyVec3 node07_R = {0.045177206350299308, 0.13693626021743299, 0.14299577247088507};
    AnyVec3 node08_R = {0.105233387840184, 0.13693626021743299, 0.149438920202936};
    AnyVec3 node09_R = {0.1490597126245711, 0.13693626021743299, 0.1086869253504958};
    AnyVec3 node10_R = {0.15394572113977775, 0.13693626021743299, 0.047342607027979759};
    AnyVec3 node11_R = node00_R;
  };
  AnyFolder AbdominalCavityPoints = {
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      
      
      #ifdef Experimental_Volume_Geo


AnyFolder EllipsoidCalculation ={

          //use height of layer... this is the node connecting on vertebrae
          AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L1.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L1.Left.Transversus_Ins_pos[1]);
          AnyFloat P0 =....P0_R;
          AnyFloat P1 =....P1_R;
          AnyFloat P0_Mid =....P0_Mid;
          AnyFloat P1_Mid =....P1_Mid;

  AnyVar Angle1 = pi/4;
  AnyVar Angle2 = -20*pi/180;
          #include "PointOnLineCal.any"
        };










      
      
        AnyFloat    PickedPoints=      
            ( {{1,0,0},{0,1,0},{0,0,0.80}}* 
      {{0.05329924, 0.1369363, -1.641731e-12}, 
        {-0.0254451, 0.1352498, 0.06976959}, 
        {0.02440975, 0.1376554, 0.1274429}, 

       
      }')';

   AnyInt size = SizesOf(PickedPoints)[0];  //number of picked points
   AnyFloat CalculatedPoints =reshape(  take(EllipsoidCalculation.Cal.CalculatedPoints,iarr(size*3,1,8*3-1)),{(8-size),3});
   Parametric.Fun.Data =(arrcat(PickedPoints,CalculatedPoints))';



      
      
      
  #include "InterpolFunWithSPar.any" 

  
      #endif
      
       #ifndef Experimental_Volume_Geo

      //create a spline function
      Parametric.Fun.Data = 
      {{1,0,0},{0,1,0},{0,0,0.80}}* 
      {{0.05329924, 0.1369363, -1.641731e-12}, 
        {-0.0254451, 0.1352498, 0.06976959}, 
        {0.02440975, 0.1376554, 0.1274429}, 
        {0.07090113, 0.1370779, 0.1161971}, 
        {0.09994919, 0.1381802, 0.1278264}, 
        {0.1231905, 0.1369363, 0.09770223}, 
        {0.1545627, 0.1369363, 0.04734261}, 
        {0.1636257, 0.136556, 0.002547507}}  ';
      
      #include "InterpolFunWithSPar.any" 
#endif

    };
          

    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
      AnyFolder EllipsoidCalculation ={
        //use height of layer... this is the node connecting on vertebrae
        AnyFloat  _y =0.5*( Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L1.Right.Transversus_Ins_pos[1]+Main.HumanModel.BodyModel.Trunk.Data.unscaled.ModelParameters.L1.Left.Transversus_Ins_pos[1]);
        AnyFloat P0 =....P0_L;
        AnyFloat P1 =....P1_L;
        AnyFloat P0_Mid =....P0_Mid;
        AnyFloat P1_Mid =....P1_Mid;

       
  AnyVar Angle1 = pi-..Right.EllipsoidCalculation.Angle1;
  AnyVar Angle2 = pi-..Right.EllipsoidCalculation.Angle2;
        #include "PointOnLineCal.any"
      };

    };
  };
};


AnyFolder Layer_Diaphragm1 = {
  AnyMat33 S = {{0.3,0,0}, {0,1,0}, {0,0,0.65}};
  AnyVec3 T = {0.05,0,0} + {-0.02,0,0};
  AnyFolder InertiaPoints = {
    AnyVec3 node00_R = {0.1393418742693604, 0.2270388619450428, 2.6460239025380978e-09};
    AnyVec3 node01_R = {0.077360995938853483, 0.2270388619450428, 1.7639430745898702e-09};
    AnyVec3 node02_R = {0.015380117608346566, 0.2270388619450428, 8.8186224664164256e-10};
    AnyVec3 node03_R = {-0.046600760722160572, 0.2270388619450428, -2.1858130658855054e-13};
    AnyVec3 node04_R = {-0.046700760722160339, 0.2270388619450428, -1.6417312388022909e-12};
    AnyVec3 node05_R = {-0.039844072485828351, 0.2270388619450428, 0.062939260581131001};
    AnyVec3 node06_R = {-0.0093117475634637049, 0.2270388619450428, 0.11345929380454584};
    AnyVec3 node07_R = {0.045177206350299308, 0.2270388619450428, 0.14299577247088507};
    AnyVec3 node08_R = {0.105233387840184, 0.2270388619450428, 0.149438920202936};
    AnyVec3 node09_R = {0.1490597126245711, 0.2270388619450428, 0.1086869253504958};
    AnyVec3 node10_R = {0.15394572113977775, 0.2270388619450428, 0.047342607027979759};
    AnyVec3 node11_R = node00_R;
  };
  AnyFolder AbdominalCavityPoints = {   
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 1;
      
      Parametric.Fun.Data= 
      { 
        {0.0832387, 0.2170389, 0.001445713}+{0,0.025,0}, 
        {0.03892661, 0.2124405, 0.01977409}+{0,0.023,0}, 
        {0.02000097, 0.217557, 0.06533772}+{0,0.019,0}, 
        {0.02255316, 0.2270389, 0.09294725}+{0,0.016,0}, 
        {0.08657002, 0.2370389, 0.0971353}+{0,0.013,0}, 
        {0.1097179, 0.2470389, 0.0706465}+{0,0.005,0}, 
        {0.1191837, 0.2570389, 0.03077269}, 
        {0.1208026, 0.2570389, 1.719916e-09}        }';    
      
      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data' * ....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };     
  }; 

    AnyFolder AbdominalVolumePoints = {
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      
      Parametric.Fun.Data=       {
        (.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L2_Diaphragm1.ARel*({0,-1,0}/vnorm({0,-1,0}))')' 
        +      .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.L2_Diaphragm1.ARel*({0,-1,0}/vnorm({0,-1,0}))')'  ) /2,
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.L1_Diaphragm2.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R12_Diaphragm1.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R11_Diaphragm1.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.R10_Diaphragm3.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm5.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.CC_Diaphragm2.ARel*({0,-1,0}/vnorm({0,-1,0}))')',
        
        (.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.Xiphoid_Diaphragm.ARel*({0,-1,0}/vnorm({0,-1,0}))')' 
        +      .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.sRel 
        + 0.8* .......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.Radius[0]*(.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Left.Xiphoid_Diaphragm.ARel*({0,-1,0}/vnorm({0,-1,0}))')'  )/2    
      }'; 

      #include "InterpolFunWithSPar.any" 
    };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };

    AnyFolder AbdominalVolumeUpperPoints = {
    AnyFolder Right = { 
      
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      
      //create a spline function
      AnyFloat VolumeTipRatio = 0.8;
      Parametric.Fun.Data=       
        (1-VolumeTipRatio)*..AbdominalVolumePoints.Right.Parametric.Fun.Data
        + repmat(8, {VolumeTipRatio*.......Abdominal.Diaphragm.CavitySegSuperoanterior.Layer_T10.Right.DomeNodeMid.sRel})';

      #include "InterpolFunWithSPar.any" 

  };
    
    AnyFolder Left = { 
      AnyVar Posterior_Spline_Start = 0;
      AnyVar Posterior_Spline_End = 0.5;
      AnyVar Anterior_Spline_Start = 0.5;
      AnyVar Anterior_Spline_End = 1;
      //create a spline function
      Parametric.Fun.Data = (.Right.Parametric.Fun.Data'*....MirrorTransform)';
      #include "InterpolFunWithSPar.any"
    };
  };

};
  
  
  AnyFolder Layer_Diaphragm1_Curved ={
    AnyMat33 S ={{0.3,0,0},{0,1,0},{0,0,0.65}};
    AnyVec3 T ={0.05,0,0}+{-0.02,0,0};
    AnyFolder InertiaPoints ={
      AnyVec3 node00_R = {0.1393418742693604, 0.2270388619450428, 2.6460239025380978e-09};
      AnyVec3 node01_R = {0.077360995938853483, 0.2270388619450428, 1.7639430745898702e-09};
      AnyVec3 node02_R = {0.015380117608346566, 0.2270388619450428, 8.8186224664164256e-10};
      AnyVec3 node03_R = {-0.046600760722160572, 0.2270388619450428, -2.1858130658855054e-13};
      AnyVec3 node04_R = {-0.046700760722160339, 0.2270388619450428, -1.6417312388022909e-12};
      AnyVec3 node05_R = {-0.039844072485828351, 0.2270388619450428, 0.062939260581131001};
      AnyVec3 node06_R = {-0.0093117475634637049, 0.2270388619450428, 0.11345929380454584};
      AnyVec3 node07_R = {0.045177206350299308, 0.2270388619450428, 0.14299577247088507};
      AnyVec3 node08_R = {0.105233387840184, 0.2270388619450428, 0.149438920202936};
      AnyVec3 node09_R = {0.1490597126245711, 0.2270388619450428, 0.1086869253504958};
      AnyVec3 node10_R = {0.15394572113977775, 0.2270388619450428, 0.047342607027979759};
      AnyVec3 node11_R = node00_R;
    };
    AnyFolder AbdominalCavityPoints ={   
      AnyFolder Right = { 
        
        AnyVar Posterior_Spline_Start =0;
        AnyVar Posterior_Spline_End =1;
        
        
        Parametric.Fun.Data= {
          
          {0.0532387, 0.2270389, 0.001445713}+ {0.015,-0.01,0} , 
          {0.02892661, 0.2224405, 0.01977409}+ {0.01,-0.01,0} , 
          {0.04000097, 0.222557, 0.06533772}+ {0.005,-0.005,0} , 
          {0.03255316, 0.2270389, 0.09294725}+ {0.005,0.0,0} , 
          {0.08157002, 0.2270389, 0.0971353}+ {0.005,0.01,0} , 
          {0.09471791, 0.2270389, 0.0706465}+{0.015,0.02,0}, 
          {0.09918372, 0.2270389, 0.03077269}+{0.02,0.03,0}, 
          {0.1008026, 0.2270389, 1.719916e-09}+{0.02,0.03,0}
        }';
        
        
        #include "InterpolFunWithSPar.any" 
      };
      
      AnyFolder Left = { 
        AnyVar Posterior_Spline_Start =0;
        AnyVar Posterior_Spline_End =1;
        //create a spline function
        Parametric.Fun.Data= (.Right.Parametric.Fun.Data'*....MirrorTransform)';
        #include "InterpolFunWithSPar.any"
      };     
    }; 
  };
  

  
