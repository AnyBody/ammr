//#define _ABDOMINAL_VISUALIZE_FOR_DEBUG


AnyFolder SpringMeasures = {
  AnyFolder Top ={
    AnyKinLinear M1 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0001; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0001; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};        
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};       
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};
      #endif 
    };
    AnyKinLinear M2 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0002; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0002; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;}; 
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M3 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0003; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0003; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M4 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0004; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0004; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};      
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};  
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M5 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0005; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0005; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};      
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M6 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0006; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0006; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    
    
    AnyKinLinear M7 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0007; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0007; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M8 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0008; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0008; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M9 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0009; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0009; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M10 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0010; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0010; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw2 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw3 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M11 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0011; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0011; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M12 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Above_Layer._node0012; 
      AnyRefNode &ref2 = ....layer_above.LayerConstraintNodes.Nodes_Below_Layer._node0012; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
  };
  
  
  AnyFolder Bot ={
    
    AnyKinLinear M1 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0001; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0001; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M2 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0002; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0002; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};   
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M3 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0003; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0003; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M4 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0004; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0004; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M5 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0005; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0005; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M6 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0006; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0006; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    
    
    AnyKinLinear M7 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0007; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0007; 
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};      
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
      Ref=0;
    };
    AnyKinLinear M8 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0008; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0008; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};    
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M9 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0009; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0009; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};      
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    AnyKinLinear M10 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0010; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0010; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw1 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};   
      #endif 
      
    };
    AnyKinLinear M11 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0011; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0011; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};     
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
      
    };
    
    AnyKinLinear M12 = {
      AnyRefNode &ref1 = ....BaseSegAnterior.LayerConstraintNodes.Nodes_Below_Layer._node0012; 
      AnyRefNode &ref2 = ....layer_below.LayerConstraintNodes.Nodes_Above_Layer._node0012; 
      Ref=0;
      #ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
      AnyDrawPLine drw ={Thickness=0.0025;};   
      ref1= {AnyDrawRefFrame drw1 ={RGB={1,0,0};ScaleXYZ={1,1,1}*0.01;};};      
      ref2= {AnyDrawRefFrame drw2 ={RGB={0,0,1};ScaleXYZ={1,1,1}*0.01;};};      
      #endif 
    };
  };
};


AnyKinEq RotationConstraint = {
  RigidBodyAverageMeasure CombinationMeasure(ROTATIONAL=On, LINEAR=On,POWER =3) = { 
    LocalReferenceFrame = &...BaseSegAnterior.Origin;
    InputMeasures = {
        &..SpringMeasures.Top.M1,
        &..SpringMeasures.Top.M2,
        &..SpringMeasures.Top.M3,
        &..SpringMeasures.Top.M4,
        &..SpringMeasures.Top.M5,
        &..SpringMeasures.Top.M6,
        &..SpringMeasures.Top.M7,
        &..SpringMeasures.Top.M8,
        &..SpringMeasures.Top.M9,
        &..SpringMeasures.Top.M10,
        &..SpringMeasures.Top.M11,
        &..SpringMeasures.Top.M12,
        &..SpringMeasures.Bot.M1,
        &..SpringMeasures.Bot.M2,
        &..SpringMeasures.Bot.M3,
        &..SpringMeasures.Bot.M4,
        &..SpringMeasures.Bot.M5,
        &..SpringMeasures.Bot.M6,
        &..SpringMeasures.Bot.M7,
        &..SpringMeasures.Bot.M8,
        &..SpringMeasures.Bot.M9,
        &..SpringMeasures.Bot.M10,
        &..SpringMeasures.Bot.M11,
        &..SpringMeasures.Bot.M12,
      
      };
      WeightCoefficients = {..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,..K_top,
        ..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot,..K_bot
      };
    };
    Reaction.Type ??= repmat(nDim, Off);
    
  
    MeasureOrganizer = .MeasureOrganizer;
  
    
  };
  
#ifdef _ABDOMINAL_VISUALIZE_FOR_DEBUG
  #undef _ABDOMINAL_VISUALIZE_FOR_DEBUG
#endif
  
  
  

