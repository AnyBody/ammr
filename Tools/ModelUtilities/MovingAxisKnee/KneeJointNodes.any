//Perhaps switch these to hinge joints defined by Medial and Lateral TF cylinder fits.

Thigh = {  
  AnyRefNode KneeJoint = {
    sRel = (.EpicondylusFemorisMedialis.sRel+.EpicondylusFemorisLateralis.sRel)/2.0;
    ARel = RotMat(sRel,.EpicondylusFemorisLateralis.sRel,.HipJoint.sRel)*RotMat(...Sign*pi/2,y);      
    AnyDrawRefFrame drw={Visible=Off;ScaleXYZ=0.1*{1,1,1};RGB={0,1,0};}; 
  };
};

 
Shank = {  
  AnyFunTransform3D &Femur_to_CT = .Thigh.SubjectSpecificScaling.Seg2CT;
  AnyRefNode KneeJoint = {
    sRel = (
       .CustomMarkerScaling(.Femur_to_CT(..Thigh.EpicondylusFemorisMedialis.sRel))
       +.CustomMarkerScaling(.Femur_to_CT(..Thigh.EpicondylusFemorisLateralis.sRel))
    )/2.0;
    ARel = RotMat(
       sRel,
       .CustomMarkerScaling(.Femur_to_CT(..Thigh.EpicondylusFemorisLateralis.sRel)),
       .CustomMarkerScaling(.Femur_to_CT(..Thigh.HipJoint.sRel))
    )*RotMat(...Sign*pi/2,y);      
    AnyDrawRefFrame drw={Visible= Off; ScaleXYZ=0.1*{1,1,1};RGB={0,1,0};};
  };
};


