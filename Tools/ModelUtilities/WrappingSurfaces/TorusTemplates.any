

#class_template Torus3PointOuterFit (AnyFolder& REFFRAME, NAME) {
  
  #var AnyVec3 P1;
  #var AnyVec3 P2;
  #var AnyVec3 P3;
  
  AnyVar denom = 2*vnorm(cross(P1-P2,P2-P3))^2;
  AnyVar alpha = vnorm(P2-P3)^2*(P1-P2)*(P1-P3)'/denom;
  AnyVar beta = vnorm(P1-P3)^2*(P2-P1)*(P2-P3)'/denom;
  AnyVar gamma = vnorm(P1-P2)^2*(P3-P1)*(P3-P2)'/denom;
  
  AnyVec3 Pcenter = alpha*P1+beta*P2+gamma*P3;
  AnyVar radius = vnorm(P1-Pcenter);
  
  REFFRAME = 
  {
    
    AnyRefNode NAME = 
    {
      
      
      
      ARel = RotMat(..P1, ..P2, ..P3);
      sRel = ..Pcenter;
      
      viewRefFrame.Visible = On;
      viewRefFrame.ScaleXYZ = 1*{1,1,1};
      AnySurfTorus Surf = 
      {
        MajorRadius = ...radius-MinorRadius;
        MinorRadius = 0.04;
       AnyDrawParamSurf drws = {
         Opacity = 0.4;
         //WireFrameOnOff = On;
       };
       
      };
    };
  };

  
};
